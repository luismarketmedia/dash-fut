"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[629],{545:function(e,a,t){t.d(a,{O:function(){return d}});var r=t(758);let i="https://dugcurqxksfufyzshfjj.supabase.co",o="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR1Z2N1cnF4a3NmdWZ5enNoZmpqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2MDcyNzcsImV4cCI6MjA3MzE4MzI3N30.W5kQ7ijvGCS8NAziwoJ4_DPpRDAfgnXTxh_kol3o5JI",d=i&&o?(0,r.eI)(i,o):{from:()=>({select:async()=>({data:[],error:null}),insert:()=>({throwOnError:async()=>({data:null,error:null})}),update:()=>({eq:()=>({throwOnError:async()=>({data:null,error:null})})}),delete:()=>({neq:()=>({throwOnError:async()=>({data:null,error:null})})}),upsert:()=>({throwOnError:async()=>({data:null,error:null})}),eq:()=>({throwOnError:async()=>({data:null,error:null})}),neq:()=>({throwOnError:async()=>({data:null,error:null})}),throwOnError:async()=>({data:null,error:null})})}},5297:function(e,a,t){t.d(a,{cn:function(){return o}});var r=t(1960),i=t(9683);function o(){for(var e=arguments.length,a=Array(e),t=0;t<e;t++)a[t]=arguments[t];return(0,i.m6)((0,r.W)(a))}},2617:function(e,a,t){t.d(a,{q:function(){return y},w:function(){return m}});var r=t(8947),i=t(9769),o=t(3081),d=t(545),l=t(3202);let n={categories:[],activeCategoryId:null,players:[],teams:[],assignments:{},matches:[],groups:{},loading:!1,workspaces:[],activeWorkspaceId:null},s="futebol-dashboard-state-v2";function c(e,a){var t,r,i,o;switch(a.type){case"HYDRATE":return a.payload;case"SET_ACTIVE_CATEGORY":return{...e,activeCategoryId:a.payload};case"ADD_CATEGORY":{let t={id:a.payload.id||crypto.randomUUID(),name:a.payload.name};return{...e,categories:[...e.categories,t],activeCategoryId:e.activeCategoryId||t.id}}case"RENAME_CATEGORY":return{...e,categories:e.categories.map(e=>e.id===a.payload.id?{...e,name:a.payload.name}:e)};case"DELETE_CATEGORY":{let r=e.categories.filter(e=>e.id!==a.payload.id),i=e.activeCategoryId===a.payload.id?(null===(t=r[0])||void 0===t?void 0:t.id)||null:e.activeCategoryId,o=e.players.filter(e=>e.categoryId!==a.payload.id),d=e.teams.filter(e=>e.categoryId!==a.payload.id),l=new Set(e.teams.filter(e=>e.categoryId===a.payload.id).map(e=>e.id)),n=Object.fromEntries(Object.entries(e.assignments).filter(e=>{let[a]=e;return!l.has(a)})),s=e.matches.filter(e=>e.categoryId!==a.payload.id),c=Object.fromEntries(Object.entries(e.groups).filter(e=>{let[a]=e;return!l.has(a)}));return{...e,categories:r,activeCategoryId:i,players:o,teams:d,assignments:n,matches:s,groups:c}}case"ADD_PLAYER":{let t=a.payload,i="id"in t?t:{id:crypto.randomUUID(),...t},o={...i,categoryId:i.categoryId||e.activeCategoryId||(null===(r=e.categories[0])||void 0===r?void 0:r.id)};return{...e,players:[...e.players,o]}}case"UPDATE_PLAYER":return{...e,players:e.players.map(e=>e.id===a.payload.id?a.payload:e)};case"DELETE_PLAYER":{let t=Object.fromEntries(Object.entries(e.assignments).map(e=>{let[t,r]=e;return[t,r.filter(e=>e!==a.payload.id)]}));return{...e,players:e.players.filter(e=>e.id!==a.payload.id),assignments:t}}case"ADD_TEAM":{let t=a.payload,r="id"in t?t:{id:crypto.randomUUID(),...t},o={...r,categoryId:r.categoryId||e.activeCategoryId||(null===(i=e.categories[0])||void 0===i?void 0:i.id)};return{...e,teams:[...e.teams,o],assignments:{...e.assignments,[o.id]:[]}}}case"UPDATE_TEAM":return{...e,teams:e.teams.map(e=>e.id===a.payload.id?a.payload:e)};case"DELETE_TEAM":{let{[a.payload.id]:t,...r}=e.assignments;return{...e,teams:e.teams.filter(e=>e.id!==a.payload.id),assignments:r}}case"SET_ASSIGNMENTS":return{...e,assignments:a.payload};case"ADD_MATCHES":return{...e,matches:[...e.matches,...a.payload]};case"UPDATE_MATCH":return{...e,matches:e.matches.map(e=>e.id===a.payload.id?a.payload:e)};case"DELETE_MATCH":return{...e,matches:e.matches.filter(e=>e.id!==a.payload.id)};case"EDIT_MATCH_TEAMS":return{...e,matches:e.matches.map(e=>e.id===a.payload.id?{...e,leftTeamId:a.payload.leftTeamId,rightTeamId:a.payload.rightTeamId,startedAt:null,half:1,remainingMs:12e5,events:{}}:e)};case"CLEAR_MATCHES":return{...e,matches:[]};case"SET_GROUPS":return{...e,groups:a.payload};case"RESET_TEAMS_AND_PHASES":return{...e,assignments:{},matches:[],groups:{}};case"SET_LOADING":return{...e,loading:a.payload};case"SET_WORKSPACES":return{...e,workspaces:a.payload,activeWorkspaceId:e.activeWorkspaceId||(null===(o=a.payload[0])||void 0===o?void 0:o.id)||null};case"SET_ACTIVE_WORKSPACE":return{...e,activeWorkspaceId:a.payload};case"RESET_ALL":return n;default:return e}}let p=(0,o.createContext)(null),m=e=>{let{children:a}=e,[t,m]=(0,o.useReducer)(c,n),y=(0,o.useRef)(!1);(0,o.useEffect)(()=>{m({type:"HYDRATE",payload:function(){try{var e;let a=localStorage.getItem(s);if(!a)return n;let t=JSON.parse(a);if(!t.players||!t.teams||!t.matches||!t.assignments)return n;return t.categories||(t.categories=[]),t.activeCategoryId||(t.activeCategoryId=(null===(e=t.categories[0])||void 0===e?void 0:e.id)||null),t.workspaces||(t.workspaces=[]),t.activeWorkspaceId||(t.activeWorkspaceId=null),t}catch(e){return n}}()}),y.current=!0},[]),(0,o.useEffect)(()=>{y.current&&localStorage.setItem(s,JSON.stringify(t))},[t]);let{userId:_}=(0,i.y)(),f=(0,o.useRef)(null),g=(0,o.useRef)(0);(0,o.useEffect)(()=>{(async()=>{if(!_)return;let e=new URL(window.location.href),a=e.searchParams.get("joinWorkspace");if(a)try{await d.O.from("workspace_members").upsert({workspace_id:a,user_id:_,role:"member"},{onConflict:"workspace_id,user_id"}).throwOnError();let{data:e}=await d.O.from("workspaces").select("id,name").eq("id",a).single();if(e){let a=t.workspaces.some(a=>a.id===e.id);m({type:"SET_WORKSPACES",payload:a?t.workspaces:[...t.workspaces,{id:e.id,name:e.name}]}),m({type:"SET_ACTIVE_WORKSPACE",payload:e.id})}}finally{e.searchParams.delete("joinWorkspace"),window.history.replaceState({},document.title,e.toString())}})()},[_]),(0,o.useEffect)(()=>{(async()=>{var e,a,r,i;if(!_)return;let o=t.activeWorkspaceId,l=t.workspaces;if(!o||0===l.length){let{data:e}=await d.O.from("workspace_members").select("workspace_id, workspaces ( id, name )").eq("user_id",_),t=(e||[]).map(e=>e.workspaces?{id:e.workspaces.id,name:e.workspaces.name}:null).filter(Boolean);if(!t.length){let{data:e,error:a}=await d.O.from("workspaces").insert({name:"Pessoal",created_by:_}).select("id, name").single();!a&&e&&(await d.O.from("workspace_members").insert({workspace_id:e.id,user_id:_,role:"owner"}),await Promise.all([d.O.from("categories").update({workspace_id:e.id}).eq("owner_id",_).is("workspace_id",null),d.O.from("players").update({workspace_id:e.id}).eq("owner_id",_).is("workspace_id",null),d.O.from("teams").update({workspace_id:e.id}).eq("owner_id",_).is("workspace_id",null),d.O.from("matches").update({workspace_id:e.id}).eq("owner_id",_).is("workspace_id",null),d.O.from("assignments").update({workspace_id:e.id}).eq("owner_id",_).is("workspace_id",null),d.O.from("match_events").update({workspace_id:e.id}).eq("owner_id",_).is("workspace_id",null)]),t=[{id:e.id,name:e.name}])}l=t,o=o||(null===(a=t[0])||void 0===a?void 0:a.id)||null,t.length&&m({type:"SET_WORKSPACES",payload:t}),o&&m({type:"SET_ACTIVE_WORKSPACE",payload:o})}let n=t.activeCategoryId||(null===(e=t.categories[0])||void 0===e?void 0:e.id)||null,s="".concat(_,"::").concat(o||"__NO_WS__","::").concat(n||"__NO_CAT__");if((f.current||void 0)===s){console.log("[App] load skip (same key)",{loadKey:s});return}f.current=s,console.log("[App] load start",{loadKey:s,wsId:o,cat:n}),m({type:"SET_LOADING",payload:!0});let c=++g.current;console.log("[App] fetch bundle",{reqId:c,wsId:o,cat:n});try{let[{data:e},{data:a},{data:s},{data:p},{data:u},{data:_}]=await Promise.all([o?d.O.from("categories").select("id, name").eq("workspace_id",o).then(e=>({data:e.data||[]})):Promise.resolve({data:[]}),n&&o?d.O.from("players").select("id, jersey_number, name, position, paid, category_id").eq("workspace_id",o).eq("category_id",n).then(e=>({data:(e.data||[]).map(e=>({id:e.id,jerseyNumber:e.jersey_number,name:e.name,position:e.position,paid:e.paid,category_id:e.category_id}))})):Promise.resolve({data:[]}),n&&o?d.O.from("teams").select("id, name, color, capacity, category_id").eq("workspace_id",o).eq("category_id",n).then(e=>({data:e.data||[]})):Promise.resolve({data:[]}),n&&o?d.O.from("assignments").select("team_id, player_id").eq("workspace_id",o).eq("category_id",n).then(e=>({data:e.data||[]})):Promise.resolve({data:[]}),n&&o?d.O.from("matches").select("id, left_team_id, right_team_id, phase, started_at, half, remaining_ms, category_id").eq("workspace_id",o).eq("category_id",n).then(e=>({data:e.data||[]})):Promise.resolve({data:[]}),n&&o?d.O.from("match_events").select("match_id, player_id, goals, yellow, red, destaque").eq("workspace_id",o).eq("category_id",n).then(e=>({data:e.data||[]})):Promise.resolve({data:[]})]);if(c!==g.current){console.log("[App] load ignore stale",{reqId:c,current:g.current});return}let f=(e||[]).map(e=>({id:e.id,name:e.name})),h=n&&f.some(e=>e.id===n)?n:(null===(r=f[0])||void 0===r?void 0:r.id)||null,E=t.activeCategoryId||(null===(i=t.categories[0])||void 0===i?void 0:i.id)||null,A=E&&f.some(e=>e.id===E)?E:h,v={};(s||[]).forEach(e=>v[e.id]=[]),(p||[]).forEach(e=>{v[e.team_id]||(v[e.team_id]=[]),v[e.team_id].push(e.player_id)});let w={};(_||[]).forEach(e=>{w[e.match_id]||(w[e.match_id]={}),w[e.match_id][e.player_id]={goals:e.goals||0,yellow:e.yellow||0,red:!!e.red,destaque:!!e.destaque}});let I=(u||[]).map(e=>{var a;return{id:e.id,leftTeamId:e.left_team_id,rightTeamId:e.right_team_id,phase:e.phase,half:e.half||1,remainingMs:null!==(a=e.remaining_ms)&&void 0!==a?a:12e5,startedAt:e.started_at?new Date(e.started_at).getTime():null,events:w[e.id]||{},categoryId:e.category_id}}),O=(s||[]).map(e=>({id:e.id,name:e.name,color:e.color,capacity:e.capacity,categoryId:e.category_id})),T=(a||[]).map(e=>({id:e.id,jerseyNumber:e.jersey_number,name:e.name,position:e.position,paid:e.paid,categoryId:e.category_id}));m({type:"HYDRATE",payload:{categories:f,activeCategoryId:A,players:T,teams:O,assignments:v,matches:I,groups:{},loading:!1,workspaces:l||[],activeWorkspaceId:o||null}}),console.log("[App] hydrate",{applyActive:A,counts:{categories:f.length,players:T.length,teams:O.length,matches:I.length}}),y.current=!0}finally{m({type:"SET_LOADING",payload:!1}),console.log("[App] load finished",{loadKey:f.current})}})()},[_,t.activeCategoryId,t.activeWorkspaceId]);let h=e=>{let a=e;if("SET_ACTIVE_CATEGORY"===e.type&&(console.log("[App] dispatch SET_ACTIVE_CATEGORY",{prev:t.activeCategoryId,next:e.payload}),e.payload===t.activeCategoryId)){console.log("[App] ignore redundant category change");return}"ADD_PLAYER"!==e.type||"id"in e.payload||(a={type:"ADD_PLAYER",payload:{id:crypto.randomUUID(),...e.payload}}),"ADD_TEAM"!==e.type||"id"in e.payload||(a={type:"ADD_TEAM",payload:{id:crypto.randomUUID(),...e.payload}}),"ADD_CATEGORY"!==e.type||"id"in e.payload||(a={type:"ADD_CATEGORY",payload:{id:crypto.randomUUID(),...e.payload}}),m(a),("SET_ACTIVE_CATEGORY"===a.type||"SET_ACTIVE_WORKSPACE"===a.type)&&_&&m({type:"SET_LOADING",payload:!0}),E(a)};async function E(e){try{var a,r;if(!_)return;let i=t.activeCategoryId||(null===(a=t.categories[0])||void 0===a?void 0:a.id)||null,o=t.activeWorkspaceId||null;switch(e.type){case"ADD_CATEGORY":await d.O.from("categories").insert({id:(null===(r=e.payload)||void 0===r?void 0:r.id)||void 0,name:e.payload.name,owner_id:_,workspace_id:o}).throwOnError();break;case"RENAME_CATEGORY":await d.O.from("categories").update({name:e.payload.name}).eq("id",e.payload.id).throwOnError();break;case"DELETE_CATEGORY":await d.O.from("categories").delete().eq("id",e.payload.id).throwOnError();break;case"ADD_PLAYER":{let a=e.payload,t=a.id?{id:a.id,jersey_number:a.jerseyNumber,name:a.name,position:a.position,paid:a.paid,owner_id:_,category_id:i,workspace_id:o}:{jersey_number:a.jerseyNumber,name:a.name,position:a.position,paid:a.paid,owner_id:_,category_id:i,workspace_id:o};await d.O.from("players").insert(t).throwOnError();break}case"UPDATE_PLAYER":await d.O.from("players").update({jersey_number:e.payload.jerseyNumber,name:e.payload.name,position:e.payload.position,paid:e.payload.paid}).eq("id",e.payload.id).throwOnError();break;case"DELETE_PLAYER":await d.O.from("players").delete().eq("id",e.payload.id).throwOnError();break;case"ADD_TEAM":{let a=e.payload,t=a.id?{id:a.id,name:a.name,color:a.color,capacity:a.capacity,owner_id:_,category_id:i,workspace_id:o}:{name:a.name,color:a.color,capacity:a.capacity,owner_id:_,category_id:i,workspace_id:o};await d.O.from("teams").insert(t).throwOnError();break}case"UPDATE_TEAM":await d.O.from("teams").update({name:e.payload.name,color:e.payload.color,capacity:e.payload.capacity}).eq("id",e.payload.id).throwOnError();break;case"DELETE_TEAM":await d.O.from("teams").delete().eq("id",e.payload.id).throwOnError();break;case"SET_ASSIGNMENTS":{if(!i)break;let a=[];for(let[t,r]of Object.entries(e.payload))for(let e of r)a.push({team_id:t,player_id:e,owner_id:_,category_id:i,workspace_id:o});o?await d.O.from("assignments").delete().eq("workspace_id",o).eq("category_id",i).throwOnError():await d.O.from("assignments").delete().eq("owner_id",_).eq("category_id",i).throwOnError(),a.length&&await d.O.from("assignments").insert(a).throwOnError();break}case"ADD_MATCHES":{if(!e.payload.length||!i)break;let a=e.payload.map(e=>({id:e.id,left_team_id:e.leftTeamId,right_team_id:e.rightTeamId,phase:e.phase,started_at:e.startedAt?new Date(e.startedAt).toISOString():null,half:e.half,remaining_ms:e.remainingMs,owner_id:_,category_id:i,workspace_id:o}));await d.O.from("matches").insert(a).throwOnError();break}case"DELETE_MATCH":await Promise.all([d.O.from("match_events").delete().eq("match_id",e.payload.id).throwOnError(),d.O.from("matches").delete().eq("id",e.payload.id).throwOnError()]);break;case"EDIT_MATCH_TEAMS":await Promise.all([d.O.from("matches").update({left_team_id:e.payload.leftTeamId,right_team_id:e.payload.rightTeamId,started_at:null,half:1,remaining_ms:12e5}).eq("id",e.payload.id).throwOnError(),d.O.from("match_events").delete().eq("match_id",e.payload.id).throwOnError()]);break;case"CLEAR_MATCHES":if(!i)break;await Promise.all([d.O.from("match_events").delete().eq("category_id",i).throwOnError(),d.O.from("matches").delete().eq("category_id",i).throwOnError()])}}catch(e){console.error(e)}}(0,o.useEffect)(()=>{let e=setInterval(()=>{let e=Date.now(),a=t.matches.filter(e=>e.startedAt);0!==a.length&&a.forEach(a=>{let t=e-(a.startedAt||0),r=Math.max(0,a.remainingMs-t),i={...a,remainingMs:r,startedAt:e};0===r&&(i.startedAt=null),m({type:"UPDATE_MATCH",payload:i})})},1e3);return()=>clearInterval(e)},[t.matches]);let A=e=>{var a,r,i,o,d,l,n;let s=t.activeCategoryId||(null===(a=t.categories[0])||void 0===a?void 0:a.id)||"",c=t.teams.filter(e=>e.categoryId===s),p=(e?t.players.filter(e=>e.paid):t.players).filter(e=>e.categoryId===s);if(0===c.length)return;let m=Object.fromEntries(c.map(e=>[e.id,[]])),y=new Set,_=["SEM POSI\xc7\xc3O","GOL","FIXO","MEIO","ALA DIREITA","ALA ESQUERDA","FRENTE"],f={"SEM POSI\xc7\xc3O":[],GOL:[],FIXO:[],MEIO:[],"ALA DIREITA":[],"ALA ESQUERDA":[],FRENTE:[]};for(let e of p)(f[r=e.position]||(f[r]=[])).push(e);for(let e of _)f[e]=u(f[e]||[]);let g={"SEM POSI\xc7\xc3O":0,GOL:0,FIXO:0,MEIO:0,"ALA DIREITA":0,"ALA ESQUERDA":0,FRENTE:0},E={};for(let e of c)E[e.id]=Math.min(e.capacity,_.length+2);_.forEach((e,a)=>{let t=f[e],r=g[e];for(let e=0;e<c.length;e++){var i;let o=c[(e+a)%c.length];if(((null===(i=m[o.id])||void 0===i?void 0:i.length)||0)>=E[o.id])continue;for(;r<t.length&&y.has(t[r].id);)r++;if(r>=t.length)break;let d=t[r];m[o.id].push(d.id),y.add(d.id),r++}g[e]=r});let A=u(p.filter(e=>"GOL"!==e.position&&!y.has(e.id))),v=0;for(let e of A){let a=0;for(;a<c.length;){let t=c[v%c.length];if(((null===(i=m[t.id])||void 0===i?void 0:i.length)||0)<E[t.id]){m[t.id].push(e.id),y.add(e.id),v++;break}v++,a++}}let w=e=>{var a;return(null===(a=m[e])||void 0===a?void 0:a.length)||0},I=e=>(m[e]||[]).some(e=>{var a;return(null===(a=p.find(a=>a.id===e))||void 0===a?void 0:a.position)!=="GOL"}),O=e=>{let a=m[e]||[],t=a.findIndex(e=>{var a;return(null===(a=p.find(a=>a.id===e))||void 0===a?void 0:a.position)!=="GOL"});return t>=0?{pid:a[t],idx:t}:null},T=0;for(;T++<100;){let e=c.map(e=>({t:e,c:w(e.id)})).sort((e,a)=>a.c-e.c),a=null!==(l=null===(o=e[0])||void 0===o?void 0:o.c)&&void 0!==l?l:0,t=null!==(n=null===(d=e[e.length-1])||void 0===d?void 0:d.c)&&void 0!==n?n:0;if(a-t<=1)break;let r=e.filter(e=>e.c===a&&I(e.t.id)),i=e.filter(e=>{var a;return e.c===t&&((null===(a=m[e.t.id])||void 0===a?void 0:a.length)||0)<E[e.t.id]});if(!r.length||!i.length)break;let s=r[0].t.id,p=i[0].t.id,y=O(s);if(!y)break;m[s].splice(y.idx,1),(m[p]||(m[p]=[])).push(y.pid)}let S={...t.assignments};for(let e of Object.keys(m))S[e]=m[e];h({type:"SET_ASSIGNMENTS",payload:S})},v=(e,a)=>{var r;let i=t.activeCategoryId||(null===(r=t.categories[0])||void 0===r?void 0:r.id)||"",o=e=>{var a;return(null===(a=t.teams.find(a=>a.id===e))||void 0===a?void 0:a.categoryId)===i},d=new Set(t.matches.filter(a=>a.phase===e&&a.categoryId===i).map(e=>[e.leftTeamId,e.rightTeamId].sort().join("::"))),l=[];if("Classifica\xe7\xe3o"===e){t.matches.filter(a=>a.phase===e&&a.categoryId===i).forEach(e=>m({type:"DELETE_MATCH",payload:{id:e.id}}));let r=u(a.slice().filter(o)),d=r.slice(0,Math.min(8,r.length)),n=d.slice(0,Math.min(4,d.length)),s=d.slice(4,Math.min(8,d.length)),c={};for(let e of n)c[e]="A";for(let e of s)c[e]="B";h({type:"SET_GROUPS",payload:c});let p=e=>{let a=u(e.slice()),t=[];for(let e=0;e+1<a.length;e+=2)t.push([a[e],a[e+1]]);return t};l=[...p(n),...p(s)]}else{let e=a.slice().filter(o);for(let a=0;a+1<e.length;a+=2)l.push([e[a],e[a+1]])}let n=l.filter(e=>{let[a,t]=e;return!d.has([a,t].sort().join("::"))}).map(a=>{let[t,r]=a;return{id:crypto.randomUUID(),leftTeamId:t,rightTeamId:r,phase:e,half:1,remainingMs:12e5,startedAt:null,events:{},categoryId:i}});n.length&&h({type:"ADD_MATCHES",payload:n})};function w(e){var a;let r=t.activeCategoryId||(null===(a=t.categories[0])||void 0===a?void 0:a.id)||"",i=t.teams.filter(e=>e.categoryId===r),o=function(e,a){let t=l.env["Oitavas"===e?"NEXT_PUBLIC_QUALIFIERS_OITAVAS":"Quartas"===e?"NEXT_PUBLIC_QUALIFIERS_QUARTAS":"Semifinal"===e?"NEXT_PUBLIC_QUALIFIERS_SEMIFINAL":"NEXT_PUBLIC_QUALIFIERS_FINAL"],r=t?parseInt(String(t),10):NaN;return Number.isFinite(r)&&r>1?Math.min(r,a):"Oitavas"===e?Math.min(16,a):"Quartas"===e?Math.min(8,a):"Semifinal"===e?Math.min(4,a):Math.min(2,a)}(e,i.length),d=new Map;for(let e of i)d.set(e.id,{teamId:e.id,name:e.name,color:e.color,Pts:0,SG:0,GF:0});let n=(e,a)=>{let r=t.assignments[e]||[],i=0;for(let e of r){let t=a.events[e];t&&(i+=t.goals)}return i};for(let e of t.matches.filter(e=>"Classifica\xe7\xe3o"===e.phase&&e.categoryId===r)){let a=d.get(e.leftTeamId),t=d.get(e.rightTeamId);if(!a||!t)continue;let r=n(a.teamId,e),i=n(t.teamId,e);a.GF+=r,t.GF+=i,a.SG+=r-i,t.SG+=i-r,r>i?a.Pts+=3:r<i?t.Pts+=3:(a.Pts+=1,t.Pts+=1)}let s=[],c=Array.from(d.values()).sort((e,a)=>a.Pts-e.Pts||a.SG-e.SG||a.GF-e.GF||e.name.localeCompare(a.name));s=c.slice(0,Math.min(o,c.length)).map(e=>e.teamId);let p=[];if(s.length>=4&&s.length%4==0){let e=s.length/4,a=Array.from({length:e},()=>[]);for(let t=0;t<e;t++)a[t].push(s[t]);for(let t=0;t<e;t++)a[e-1-t].push(s[e+t]);for(let t=0;t<e;t++)a[t].push(s[2*e+t]);for(let t=0;t<e;t++)a[e-1-t].push(s[3*e+t]);for(let e of a)4===e.length&&(p.push([e[0],e[3]]),p.push([e[1],e[2]]))}else for(let e=0;e+1<s.length;e+=2)p.push([s[e],s[e+1]]);t.matches.filter(a=>a.phase===e&&a.categoryId===r).forEach(e=>m({type:"DELETE_MATCH",payload:{id:e.id}}));let y=p.map(a=>{let[t,i]=a;return{id:crypto.randomUUID(),leftTeamId:t,rightTeamId:i,phase:e,half:1,remainingMs:12e5,startedAt:null,events:{},categoryId:r}});y.length&&h({type:"ADD_MATCHES",payload:y})}let I=(e,a,r)=>{var i;let o=t.matches.find(a=>a.id===e);if(!o)return;let l=r(o.events[a]||{goals:0,yellow:0,red:!1,destaque:!1});m({type:"UPDATE_MATCH",payload:{...o,events:{...o.events,[a]:l}}});let n=t.activeCategoryId||(null===(i=t.categories[0])||void 0===i?void 0:i.id)||null,s=t.activeWorkspaceId||null;d.O.from("match_events").upsert({match_id:e,player_id:a,goals:l.goals,yellow:l.yellow,red:l.red,destaque:l.destaque,owner_id:_||null,category_id:n,workspace_id:s},{onConflict:"match_id,player_id,owner_id,category_id"}).throwOnError()},O=(e,a)=>{var r;let i=t.matches.find(a=>a.id===e);if(!i)return;let o=i.events[a]||{goals:0,yellow:0,red:!1,destaque:!1},l=!o.destaque,n={};for(let[e,a]of Object.entries(i.events))n[e]={...a,destaque:!1};n[a]={...o,destaque:l},m({type:"UPDATE_MATCH",payload:{...i,events:n}});let s=Array.from(new Set([...Object.keys(n),a])),c=t.activeCategoryId||(null===(r=t.categories[0])||void 0===r?void 0:r.id)||null,p=t.activeWorkspaceId||null;Promise.all(s.map(t=>{var r,i,o,s,m,y;return d.O.from("match_events").upsert({match_id:e,player_id:t,goals:null!==(s=null===(r=n[t])||void 0===r?void 0:r.goals)&&void 0!==s?s:0,yellow:null!==(m=null===(i=n[t])||void 0===i?void 0:i.yellow)&&void 0!==m?m:0,red:null!==(y=null===(o=n[t])||void 0===o?void 0:o.red)&&void 0!==y&&y,destaque:t===a&&l,owner_id:_||null,category_id:c,workspace_id:p},{onConflict:"match_id,player_id,owner_id,category_id"}).throwOnError()}))},T=e=>{let a=t.matches.find(a=>a.id===e);if(!a)return;let r={...a,startedAt:a.startedAt?null:Date.now()};m({type:"UPDATE_MATCH",payload:r}),d.O.from("matches").update({started_at:r.startedAt?new Date(r.startedAt).toISOString():null}).eq("id",e)},S=e=>{let a=t.matches.find(a=>a.id===e);if(!a)return;let r={...a,startedAt:null,remainingMs:12e5};m({type:"UPDATE_MATCH",payload:r}),d.O.from("matches").update({started_at:null,remaining_ms:r.remainingMs}).eq("id",e)},k=e=>{let a=t.matches.find(a=>a.id===e);if(!a)return;let r=1===a.half?2:1,i={...a,half:r,startedAt:null,remainingMs:12e5};m({type:"UPDATE_MATCH",payload:i}),d.O.from("matches").update({half:i.half,started_at:null,remaining_ms:i.remainingMs}).eq("id",e)},C=(0,o.useMemo)(()=>({state:t,dispatch:h,drawTeams:A,generateMatches:v,generateEliminationFromStandings:w,resetDrawAndPhases:()=>h({type:"RESET_TEAMS_AND_PHASES"}),updatePlayerStat:I,setUniqueDestaque:O,startPauseTimer:T,resetTimer:S,nextHalf:k}),[t]);return(0,r.jsx)(p.Provider,{value:C,children:a})},y=()=>{let e=(0,o.useContext)(p);if(!e)throw Error("useApp must be used within AppProvider");return e};function u(e){let a=e.slice();for(let e=a.length-1;e>0;e--){let t=Math.floor(Math.random()*(e+1));[a[e],a[t]]=[a[t],a[e]]}return a}}}]);